<html lang=”en”>

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Name of the app -->
	<title>Camera App</title>

	<!-- Link to main style sheet -->
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<main class="main-body">
		<h1>Testing demo</h1>
		<canvas id="myCanvas" width="300" height="300" style="border:1px solid #d3d3d3;" (click)="file.change()">
			Your browser does not support the HTML5 canvas tag.</canvas>
		<div class="example-block">
			<input type="file" name="image" accept="image/*;capture=camera, video/*;capture=camera" id="image-camera"
				onchange="UploadImage(files)" #file>
		</div>
	</main>


	<!-- Reference to your JavaScript file -->
	<script>
		var c = document.getElementById("myCanvas");
		c.onclick = () => {
			document.getElementById('image-camera').click()
		}
		var ctx = c.getContext("2d");
		var img = new Image()
		img.src = './images/fameimage.png'
		onload = () => {
			ctx.drawImage(img, 0, 0, c.width, c.height);
		}
		var i;
		var video
		UploadImage = (value) => {
			if (video) {
				video.pause()
			}
			if (i) {
				clearInterval(i);
			}
			ctx.clearRect(0, 0, c.width, c.height);
			ctx.drawImage(img, 0, 0, c.width, c.height);
			var source = value[0]
			var type = source.type.split('/')[0]
			var reader = new FileReader();
			if (source) {
				reader.readAsDataURL(source);
			}
			reader.onloadend = () => {
				if (type === 'image') {
					var img2 = new Image();
					img2.src = reader.result
					img2.onload = () => {
						var rwh = img2.width / img2.height
						var newWidth = c.width
						var newHeight = newWidth / rwh
						if (rwh > 1) {
							newHeight = c.height
							newWidth = newHeight * rwh
						}
						var xOffset = rwh > 1 ? ((c.width - newWidth) / 2) : 0;
						var yOffset = rwh <= 1 ? ((c.height - newHeight) / 2) : 0;
						ctx.drawImage(img2, xOffset, yOffset, newWidth, newHeight);
						ctx.drawImage(img, 0, 0, c.width, c.height);
					}
				} else if (type === 'video') {
					video = document.createElement('VIDEO')
					// video.muted = true
					video.src = reader.result
					video.play()
					video.onloadeddata = () => {
						var rwh = video.videoWidth / video.videoHeight
						var newWidth = c.width
						var newHeight = newWidth / rwh
						if (rwh > 1) {
							newHeight = c.height
							newWidth = newHeight * rwh
						}
						var xOffset = rwh > 1 ? ((c.width - newWidth) / 2) : 0;
						var yOffset = rwh <= 1 ? ((c.height - newHeight) / 2) : 0;
						i = setInterval(() => {
							ctx.drawImage(video, xOffset, yOffset, newWidth, newHeight);
							ctx.drawImage(img, 0, 0, c.width, c.height)
						}, 20);
					}
				} else {
					alert('File not supported')
				}
			}
		}
	</script>
</body>

</html>